# Using worldfootball.net to get soccer results

This is a sandbox to make things go.

Typical url is

```{r}
#| eval: false
my_url <- "https://www.worldfootball.net/all_matches/eng-premier-league-1996-1997/"
```

packages

```{r}
library(tidyverse)
library(rvest)
library(conflicted)
conflicts_prefer(dplyr::filter)
source("functions.R")
```



```{r}
leagues %>% mutate(fname = make_fname(country, league, season))
```


download all leagues

```{r}
nrow <- nrow(leagues)
nrow
walk(1:nrow, \(i) get_schedule_row(i, leagues))
```

get leagues I don't have any of yet

```{r}
leagues %>% mutate(fname = make_fname(country, league, season)) %>% 
  mutate(mtime = file.mtime(fname)) %>% 
  filter(is.na(mtime)) -> l_to_get
l_to_get
walk(1:nrow(l_to_get), \(i) get_schedule_row(i, l_to_get))
```


```{r}
find_games(leagues, hours_back = 2, hours_forward = 10)
```

games that have finished since last download

```{r}
leagues %>% mutate(fname = make_fname(country, league, season)) %>% 
  mutate(mtime = file.mtime(fname)) -> ll
ll
find_games(ll, ll$mtime, 2.25, 0) -> l3 
l3 %>% select(country, league, ko, t1, t2, score)
l3 %>% nest_by(country, league, season) -> lll
walk(1:nrow(lll), \(i) get_schedule_row(i, lll))
```

there is also an overview page with latest games and league table.
This might be better to download to check latest scores.

to check for score changes:
- find the games that might have changed since last download, save df
- redownload those, save new df
- compare
