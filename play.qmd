# Using worldfootball.net to get soccer results

This is a sandbox to make things go.

Typical url is

```{r}
#| eval: false
my_url <- "https://www.worldfootball.net/all_matches/eng-premier-league-1996-1997/"
```

packages

```{r}
library(tidyverse)
library(rvest)
library(conflicted)
conflicts_prefer(dplyr::filter)
source("functions.R")
```



```{r}
leagues %>% mutate(fname = make_fname(country, league, season, part))
```


download all leagues

```{r}
#| warning: false
# download_these(leagues)
```

get leagues I don't have any of yet

```{r}
#| warning: false
leagues %>% mutate(fname = make_fname(country, league, season, part)) %>% 
  mutate(mtime = file.mtime(fname)) %>% 
  filter(is.na(mtime)) -> l_to_get
l_to_get
download_these(l_to_get)
```


```{r}
leagues
display_league(leagues, 10)
```



games that may have finished since last download



```{r}
gg <- games_to_get(leagues, 3)
gg
lg <- leagues_to_get(gg)
lg
```

```{r}
#| warning: false
download_these(lg)
# gg1 <- games_to_get(leagues, 3)
# gg1 %>% left_join(gg, by = c("season", "country", "league", "ko", "t1", "t2")) %>% 
#   mutate(same = case_when(
#     score.x == score.y ~ TRUE,
#     score.x != score.y ~ FALSE,
#     is.na(score.x)     ~ TRUE,
#     is.na(score.y)     ~ FALSE
#   )) %>% 
#   filter(!same) %>% 
#   select(country, league, ko, t1, t2, old = score.y, new = score.x)
```

what this doesn't have is minutes or status (indication that match has finished), which seems not even to be in the match details


there is also an overview page with latest games and league table.
This might be better to download to check latest scores.

next: ratings from these leagues. Use a non-informative prior.



