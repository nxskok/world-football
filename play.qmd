# Using worldfootball.net to get soccer results

This is a sandbox to make things go.

Typical url is

```{r}
#| eval: false
my_url <- "https://www.worldfootball.net/all_matches/eng-premier-league-1996-1997/"
```

packages

```{r}
library(tidyverse)
library(rvest)
library(conflicted)
conflicts_prefer(dplyr::filter)
source("functions.R")
```



```{r}
leagues %>% mutate(fname = make_fname(country, league, season, part))
```


download all leagues

```{r}
#| warning: false
# download_these(leagues)
```

get leagues I don't have any of yet

```{r}
#| warning: false
leagues %>% mutate(fname = make_fname(country, league, season, part)) %>% 
  mutate(mtime = file.mtime(fname)) %>% 
  filter(is.na(mtime)) -> l_to_get
l_to_get
download_these(l_to_get)
```


```{r}
leagues
display_league(leagues, 53) %>% View()
```



games that may have finished (or started) since last download


```{r}
#| warning: false
now()
ggg <- update_leagues(leagues)
```

now I need to get the same games from the new download

```{r}
# ggg <- .Last.value # for row
# ggg
ggg %>% count(r) %>% pull(r) -> r
# r
map(r, \(r) display_league(leagues, r)) %>% bind_rows() -> all_games
# all_games
ggg %>% left_join(all_games, by = c("ko", "t1", "t2")) %>% 
  mutate(show = case_when(
    is.na(score.y) ~ "no",
    is.na(score.x) ~ "yes",
    score.x == score.y ~ "no",
    .default = "yes"
  )) %>% 
  filter(show == "yes") %>% 
  select(country, league, ko:score.y)
```



ratings

method 1: update ratings each time each league is updated (extra computation)
method 2: do it like 25, have a target date for the next rate and rerate the ones that have reached the target date

next task

rate a league

after that

sim-league
for predict-the-football

